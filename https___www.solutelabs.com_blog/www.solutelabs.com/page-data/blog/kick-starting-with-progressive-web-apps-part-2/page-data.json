{"componentChunkName":"component---src-components-blogs-blog-detail-js","path":"/blog/kick-starting-with-progressive-web-apps-part-2","result":{"pageContext":{"post":{"id":"58e64185-8295-5f2f-b460-ae8be0ce55d0","title":"Kick starting with Progressive Web Apps Part 2","excerpt":"In the previous blog you learnt how to register service worker and cache the resources in our app on the initial load.Now when you open up…","_rawBody":[{"_key":"ea0bf455f028","_type":"block","children":[{"_key":"ea0bf455f0280","_type":"span","marks":[],"text":"In the previous blog you learnt how to register service worker and cache the resources in our app on the initial load.Now when you open up a page that has a service worker already registered. Then if you open up another page that falls within the scope of that service worker the browser doesn’t spin up the another service worker it uses the same one. That means if you have multiple tabs open or windows open there exists only one service worker."}],"markDefs":[],"style":"normal"},{"_key":"22047cc2f601","_type":"block","children":[{"_key":"22047cc2f6010","_type":"span","marks":[],"text":"But what happens when you update the service worker, the new service worker sits idle waiting until all the windows using previous service worker gets closed."}],"markDefs":[],"style":"normal"},{"_key":"bc8b554acf20","_type":"block","children":[{"_key":"bc8b554acf200","_type":"span","marks":[],"text":"In order to avoid this we can use skipWaiting() in install event and clients claim() in activate event so that without any waiting the new service worker takes over the control of the pages."}],"markDefs":[],"style":"normal"},{"_key":"bda97a67be77","_type":"code","code":"//service-worker.js\r\nvar cacheName = 'cache_version2';\r\nself.addEventListener('install',function(e){\r\n    console.log(\"[Service Worker] Installed\");\r\n    e.waitUntil(\r\n        caches.open(cacheName).then(function(cache){\r\n            console.log(\"[ServiceWorker] Caching cacheFiles\");\r\n            cache.addAll(cacheFiles);\r\n        }).then(function() {\r\n            return self.skipWaiting();\r\n      })\r\n    )\r\n})\r\nself.addEventListener('activate', function(e){\r\n    console.log(\"[Service Worker] Activated\");\r\n    e.waitUntil(self.clients.claim());\r\n})"},{"_key":"b92c69fa65b5","_type":"block","children":[{"_key":"b92c69fa65b50","_type":"span","marks":[],"text":"But wait what happens to the files previously stored in the cache after installing a new one?"}],"markDefs":[],"style":"normal"},{"_key":"dbcdf5df5975","_type":"block","children":[{"_key":"dbcdf5df59750","_type":"span","marks":[],"text":"The browser doesn’t know whether you are going to need the old ones or not. So it’s up to you to clean the unused files from the cache.The activate event is the perfect place to do this."}],"markDefs":[],"style":"normal"},{"_key":"ed47da3a9380","_type":"code","code":"//service-worker.js\r\nvar cacheName = 'cache_version2';\r\nself.addEventListener('activate', function(e){\r\n   console.log(\"[Service Worker] Activated\");\r\n   e.waitUntil(\r\n    caches.keys().then(function(cacheNames){\r\n     return Promise.all(cacheNames.map(function(thisCacheName){\r\n     if(thisCacheName != cacheName)\r\n     {\r\n      console.log(\"[Service Worker] Removing Cached Files from\", thisCacheName);\r\n      return caches.delete(thisCacheName);\r\n     }\r\n     }))\r\n     }).then(function(){\r\n       return self.clients.claim();\r\n     })\r\n   )\r\n})"},{"_key":"3f0aea84cce8","_type":"block","children":[{"_key":"3f0aea84cce80","_type":"span","marks":[],"text":"When the activate event is fired the code gets a list of current cache keys and iterates through them using map function.It then compares the key to the current key and if they’re not equal purges them."}],"markDefs":[],"style":"normal"},{"_key":"bc27e69ade6e","_type":"customImage","alt":"If using chrome refresh the Cache Storage to see the latest cache resouces!","asset":{"_ref":"image-682e52e0e6ad70b70ccbddf98f8def861a21648b-1050x348-png","_type":"reference"},"imageFigcaptionName":"If using chrome refresh the Cache Storage to see the latest cache resouces!"},{"_key":"243d0358f230","_type":"block","children":[{"_key":"243d0358f2300","_type":"span","marks":["strong"],"text":"Note :"},{"_key":"243d0358f2301","_type":"span","marks":[],"text":" If your service worker file doesn’t get updated and still points out the old service worker file be sure to check that your browser cache max age is set zero.(cache max age : 0)"}],"markDefs":[],"style":"normal"},{"_key":"a19e3051bdc0","_type":"block","children":[{"_key":"a19e3051bdc00","_type":"span","marks":["strong"],"text":"To kick start with Progressive Web App you can go through my blogs :"},{"_key":"a19e3051bdc01","_type":"span","marks":[],"text":"\n\n1) "},{"_key":"a19e3051bdc02","_type":"span","marks":["99af92ab9221"],"text":"Register service worker and cache the resources in our app on the initial load."},{"_key":"a19e3051bdc03","_type":"span","marks":[],"text":"\n\n2) Update the old service worker and cache the new response in Cache Storage.\n\n3) "},{"_key":"a19e3051bdc04","_type":"span","marks":["6777a90f2201"],"text":"Get out the resources from the cache and intercept the network requests."},{"_key":"a19e3051bdc05","_type":"span","marks":[],"text":"\n\n4) "},{"_key":"a19e3051bdc06","_type":"span","marks":["9f75b24c135b"],"text":"Make our web app installable via the Web App Manifest File."},{"_key":"a19e3051bdc07","_type":"span","marks":[],"text":"\n\n5) "},{"_key":"a19e3051bdc08","_type":"span","marks":["4bd104b965cc"],"text":"Grey out the things when offline."},{"_key":"a19e3051bdc09","_type":"span","marks":[],"text":""}],"markDefs":[{"_key":"99af92ab9221","_type":"link","href":"https://medium.com/@shailajashah93/kick-starting-with-progressive-web-apps-part-1-6701c9ea348"},{"_key":"6777a90f2201","_type":"link","href":"https://medium.com/@shailajashah93/kick-starting-with-progressive-web-apps-part-3-4d3f139f6f07"},{"_key":"9f75b24c135b","_type":"link","href":"https://medium.com/@shailajashah93/kick-starting-with-progressive-web-apps-part-4-cd901de01a82"},{"_key":"4bd104b965cc","_type":"link","href":"https://medium.com/@shailajashah93/kick-starting-with-progressive-web-apps-part-5-b7d6a4778bd1"}],"style":"blockquote"},{"Separatorr":true,"_key":"f9c5671d6c69","_type":"separator"},{"_key":"9af1249a958e","_type":"block","children":[{"_key":"9af1249a958e0","_type":"span","marks":["strong"],"text":"SoluteLabs"},{"_key":"9af1249a958e1","_type":"span","marks":[],"text":" is a "},{"_key":"9af1249a958e2","_type":"span","marks":["fda452e369e1"],"text":"high-performance team"},{"_key":"9af1249a958e3","_type":"span","marks":[],"text":" of 25 focused on mobile and web design and development; we have produced top #10 chart topping applications on Android and iOS app stores, graphics that have gone viral and applications with Millions of downloads."}],"markDefs":[{"_key":"fda452e369e1","_type":"link","href":"https://www.solutelabs.com/careers"}],"style":"normal"}],"_rawFaq":null,"publishedAt":"2017-03-28T18:30:00.000Z","_updatedAt":"2020-08-31T08:30:56Z","readingTime":"3 min read","altTagMainImage":null,"titleMetaData":null,"shortanchorlinkh2":[],"categories":[{"id":"61b2fbb3-23c5-54d6-aac3-bf8ba2dcecc3","title":"Blog"}],"mainImage":{"asset":{"id":"image-607b60a355a5ff7f23b2d4dda0a8e6fe75b30456-2240x1260-png","url":"https://cdn.sanity.io/images/ay6gmb6r/production/607b60a355a5ff7f23b2d4dda0a8e6fe75b30456-2240x1260.png","fluid":{"sizes":"(max-width: 800px) 100vw, 800px","src":"https://cdn.sanity.io/images/ay6gmb6r/production/607b60a355a5ff7f23b2d4dda0a8e6fe75b30456-2240x1260.png?w=800&h=450&fit=crop","srcSet":"https://cdn.sanity.io/images/ay6gmb6r/production/607b60a355a5ff7f23b2d4dda0a8e6fe75b30456-2240x1260.png?w=200&h=113&fit=crop 200w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/607b60a355a5ff7f23b2d4dda0a8e6fe75b30456-2240x1260.png?w=400&h=225&fit=crop 400w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/607b60a355a5ff7f23b2d4dda0a8e6fe75b30456-2240x1260.png?w=800&h=450&fit=crop 800w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/607b60a355a5ff7f23b2d4dda0a8e6fe75b30456-2240x1260.png?w=1200&h=675&fit=crop 1200w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/607b60a355a5ff7f23b2d4dda0a8e6fe75b30456-2240x1260.png?w=1600&h=900&fit=crop 1600w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/607b60a355a5ff7f23b2d4dda0a8e6fe75b30456-2240x1260.png 2240w"}}},"author":{"id":"8cd84183-f4f8-5da6-a73e-8c9d74a15411","name":"Shailaja Shah","myColor":{"hex":"#1641ff"},"image":{"asset":{"_id":"image-7836057324a2978e02e64bb8256986a9215cdf03-288x288-png","assetId":"7836057324a2978e02e64bb8256986a9215cdf03","_type":"sanity.imageAsset","id":"image-7836057324a2978e02e64bb8256986a9215cdf03-288x288-png"},"_type":"image","_key":null},"slug":{"current":"shailaja-shah"}},"slug":{"current":"kick-starting-with-progressive-web-apps-part-2"},"tags":[{"id":"972e5e19-d560-545f-9fdc-3e57d3e0e53f","slug":{"current":"progressive-web-apps"},"title":"Progressive web apps"},{"id":"9b4c8e06-fe1d-54a8-b141-e28cfa915336","slug":{"current":"web-development"},"title":"Web Development"},{"id":"e1974141-9248-52b4-a703-c1eef63e4630","slug":{"current":"pwa"},"title":"PWA"}],"referenceBlogPost":[{"mainImage":{"asset":{"id":"image-fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260-png","fluid":{"src":"https://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=800&h=450&fit=crop","srcSet":"https://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=200&h=113&fit=crop 200w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=400&h=225&fit=crop 400w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=800&h=450&fit=crop 800w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=1200&h=675&fit=crop 1200w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=1600&h=900&fit=crop 1600w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png 2240w","sizes":"(max-width: 800px) 100vw, 800px"}}},"publishedAt":"2017-03-28T18:30:00.000Z","readingTime":"4 min read","author":{"name":"Shailaja Shah"},"slug":{"current":"kick-starting-with-progressive-web-apps-part-1"},"title":"Kick starting with Progressive Web Apps Part 1"},{"mainImage":{"asset":{"id":"image-7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260-png","fluid":{"src":"https://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=800&h=450&fit=crop","srcSet":"https://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=200&h=113&fit=crop 200w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=400&h=225&fit=crop 400w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=800&h=450&fit=crop 800w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=1200&h=675&fit=crop 1200w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=1600&h=900&fit=crop 1600w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png 2240w","sizes":"(max-width: 800px) 100vw, 800px"}}},"publishedAt":"2017-03-28T18:30:00.000Z","readingTime":"3 min read","author":{"name":"Shailaja Shah"},"slug":{"current":"kick-starting-with-progressive-web-apps-part-3"},"title":"Kick starting with Progressive Web Apps Part 3"}]},"readNextBlog":[{"mainImage":{"asset":{"id":"image-fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260-png","fluid":{"src":"https://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=800&h=450&fit=crop","srcSet":"https://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=200&h=113&fit=crop 200w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=400&h=225&fit=crop 400w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=800&h=450&fit=crop 800w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=1200&h=675&fit=crop 1200w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png?w=1600&h=900&fit=crop 1600w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/fb6fb5be6a5039126ace78bfe6128f6a1df82641-2240x1260.png 2240w","sizes":"(max-width: 800px) 100vw, 800px"}}},"publishedAt":"2017-03-28T18:30:00.000Z","readingTime":"4 min read","author":{"name":"Shailaja Shah"},"slug":{"current":"kick-starting-with-progressive-web-apps-part-1"},"title":"Kick starting with Progressive Web Apps Part 1"},{"mainImage":{"asset":{"id":"image-7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260-png","fluid":{"src":"https://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=800&h=450&fit=crop","srcSet":"https://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=200&h=113&fit=crop 200w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=400&h=225&fit=crop 400w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=800&h=450&fit=crop 800w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=1200&h=675&fit=crop 1200w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png?w=1600&h=900&fit=crop 1600w,\nhttps://cdn.sanity.io/images/ay6gmb6r/production/7296bfd7f03279dfd9b02fd290d6ab539d3fa952-2240x1260.png 2240w","sizes":"(max-width: 800px) 100vw, 800px"}}},"publishedAt":"2017-03-28T18:30:00.000Z","readingTime":"3 min read","author":{"name":"Shailaja Shah"},"slug":{"current":"kick-starting-with-progressive-web-apps-part-3"},"title":"Kick starting with Progressive Web Apps Part 3"}],"blogSLug":"kick-starting-with-progressive-web-apps-part-2"}},"staticQueryHashes":["1951403926","2015784780","2763451262","3649515864","3810076356","4118766420"]}